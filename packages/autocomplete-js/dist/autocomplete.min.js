var Autocomplete = (function() {
  'use strict'
  function t(t, e) {
    if (!(t instanceof e))
      throw new TypeError('Cannot call a class as a function')
  }
  function e(t, e) {
    for (var n = 0; n < e.length; n++) {
      var i = e[n]
      ;(i.enumerable = i.enumerable || !1),
        (i.configurable = !0),
        'value' in i && (i.writable = !0),
        Object.defineProperty(t, i.key, i)
    }
  }
  function n(t, n, i) {
    return (
      n && e(t.prototype, n),
      i && e(t, i),
      Object.defineProperty(t, 'prototype', { writable: !1 }),
      t
    )
  }
  function i(t, e, n) {
    return (
      e in t
        ? Object.defineProperty(t, e, {
            value: n,
            enumerable: !0,
            configurable: !0,
            writable: !0,
          })
        : (t[e] = n),
      t
    )
  }
  var s = function(t, e) {
      return t.matches
        ? t.matches(e)
        : t.msMatchesSelector
        ? t.msMatchesSelector(e)
        : t.webkitMatchesSelector
        ? t.webkitMatchesSelector(e)
        : null
    },
    o = function(t, e) {
      return t.closest
        ? t.closest(e)
        : (function(t, e) {
            for (var n = t; n && 1 === n.nodeType; ) {
              if (s(n, e)) return n
              n = n.parentNode
            }
            return null
          })(t, e)
    },
    u = function(t) {
      return Boolean(t && 'function' == typeof t.then)
    },
    l = n(function e() {
      var n = this,
        s = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {},
        l = s.search,
        r = s.autoSelect,
        a = void 0 !== r && r,
        c = s.setValue,
        d = void 0 === c ? function() {} : c,
        h = s.setAttribute,
        p = void 0 === h ? function() {} : h,
        b = s.onUpdate,
        f = void 0 === b ? function() {} : b,
        v = s.onSubmit,
        L = void 0 === v ? function() {} : v,
        m = s.onShow,
        g = void 0 === m ? function() {} : m,
        y = s.autocorrect,
        w = void 0 !== y && y,
        R = s.onHide,
        S = void 0 === R ? function() {} : R,
        x = s.onLoading,
        A = void 0 === x ? function() {} : x,
        E = s.onLoaded,
        k = void 0 === E ? function() {} : E,
        I = s.submitOnEnter,
        C = void 0 !== I && I
      t(this, e),
        i(this, 'value', ''),
        i(this, 'searchCounter', 0),
        i(this, 'results', []),
        i(this, 'selectedIndex', -1),
        i(this, 'selectedResult', null),
        i(this, 'destroy', function() {
          (n.search = null),
            (n.setValue = null),
            (n.setAttribute = null),
            (n.onUpdate = null),
            (n.onSubmit = null),
            (n.autocorrect = null),
            (n.onShow = null),
            (n.onHide = null),
            (n.onLoading = null),
            (n.onLoaded = null)
        }),
        i(this, 'handleInput', function(t) {
          var e = t.target.value
          n.updateResults(e), (n.value = e)
        }),
        i(this, 'handleKeyDown', function(t) {
          var e = t.key
          switch (e) {
            case 'Up':
            case 'Down':
            case 'ArrowUp':
            case 'ArrowDown':
              var i =
                'ArrowUp' === e || 'Up' === e
                  ? n.selectedIndex - 1
                  : n.selectedIndex + 1
              t.preventDefault(), n.handleArrows(i)
              break
            case 'Tab':
              n.selectResult()
              break
            case 'Enter':
              var s = t.target.getAttribute('aria-activedescendant').length > 0
              ;(n.selectedResult =
                n.results[n.selectedIndex] || n.selectedResult),
                n.selectResult(),
                n.submitOnEnter
                  ? n.selectedResult && n.onSubmit(n.selectedResult)
                  : s
                  ? t.preventDefault()
                  : (n.selectedResult && n.onSubmit(n.selectedResult),
                    (n.selectedResult = null))
              break
            case 'Esc':
            case 'Escape':
              n.hideResults(), n.setValue()
              break
            default:
              return
          }
        }),
        i(this, 'handleFocus', function(t) {
          var e = t.target.value
          n.updateResults(e), (n.value = e)
        }),
        i(this, 'handleBlur', function() {
          n.hideResults()
        }),
        i(this, 'handleResultMouseDown', function(t) {
          t.preventDefault()
        }),
        i(this, 'handleResultClick', function(t) {
          var e = t.target,
            i = o(e, '[data-result-index]')
          if (i) {
            n.selectedIndex = parseInt(i.dataset.resultIndex, 10)
            var s = n.results[n.selectedIndex]
            n.selectResult(), n.onSubmit(s)
          }
        }),
        i(this, 'handleArrows', function(t) {
          var e = n.results.length
          ;(n.selectedIndex = ((t % e) + e) % e),
            n.onUpdate(n.results, n.selectedIndex)
        }),
        i(this, 'selectResult', function() {
          var t = n.results[n.selectedIndex]
          t && n.setValue(t), n.hideResults()
        }),
        i(this, 'updateResults', function(t) {
          var e = ++n.searchCounter
          n.onLoading(),
            n.search(t).then(function(t) {
              e === n.searchCounter &&
                ((n.results = t),
                n.onLoaded(),
                0 !== n.results.length
                  ? ((n.selectedIndex = n.autoSelect ? 0 : -1),
                    n.onUpdate(n.results, n.selectedIndex),
                    n.showResults())
                  : n.hideResults())
            })
        }),
        i(this, 'showResults', function() {
          n.setAttribute('aria-expanded', !0), n.onShow()
        }),
        i(this, 'hideResults', function() {
          (n.selectedIndex = -1),
            (n.results = []),
            n.setAttribute('aria-expanded', !1),
            n.setAttribute('aria-activedescendant', ''),
            n.onUpdate(n.results, n.selectedIndex),
            n.onHide()
        }),
        i(this, 'checkSelectedResultVisible', function(t) {
          var e = t.querySelector(
            '[data-result-index="'.concat(n.selectedIndex, '"]')
          )
          if (e) {
            var i = t.getBoundingClientRect(),
              s = e.getBoundingClientRect()
            s.top < i.top
              ? (t.scrollTop -= i.top - s.top)
              : s.bottom > i.bottom && (t.scrollTop += s.bottom - i.bottom)
          }
        }),
        (this.search = u(l)
          ? l
          : function(t) {
              return Promise.resolve(l(t))
            }),
        (this.autoSelect = a),
        (this.setValue = d),
        (this.setAttribute = p),
        (this.onUpdate = f),
        (this.onSubmit = L),
        (this.autocorrect = w),
        (this.onShow = g),
        (this.onHide = S),
        (this.onLoading = A),
        (this.onLoaded = k),
        (this.submitOnEnter = C)
    }),
    r = 0,
    a = function() {
      var t =
        arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : ''
      return ''.concat(t).concat(++r)
    },
    c = function(t, e) {
      var n = t.getBoundingClientRect(),
        i = e.getBoundingClientRect()
      return n.bottom + i.height > window.innerHeight &&
        window.innerHeight - n.bottom < n.top &&
        window.pageYOffset + n.top - i.height > 0
        ? 'above'
        : 'below'
    },
    d = function(t, e, n) {
      var i
      return function() {
        var s = this,
          o = arguments,
          u = function() {
            (i = null), n || t.apply(s, o)
          },
          l = n && !i
        clearTimeout(i), (i = setTimeout(u, e)), l && t.apply(s, o)
      }
    },
    h = function(t) {
      if (null != t && t.length) {
        var e = t.startsWith('#')
        return {
          attribute: e ? 'aria-labelledby' : 'aria-label',
          content: e ? t.substring(1) : t,
        }
      }
    },
    p = (function() {
      function e(n, i, s) {
        t(this, e),
          (this.id = ''.concat(s, '-result-').concat(n)),
          (this.class = ''.concat(s, '-result')),
          (this['data-result-index'] = n),
          (this.role = 'option'),
          n === i && (this['aria-selected'] = 'true')
      }
      return (
        n(e, [
          {
            key: 'toString',
            value: function() {
              var t = this
              return Object.keys(this).reduce(function(e, n) {
                return ''
                  .concat(e, ' ')
                  .concat(n, '="')
                  .concat(t[n], '"')
              }, '')
            },
          },
        ]),
        e
      )
    })()
  return n(function e(n) {
    var s = this,
      o = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {},
      u = o.search,
      r = o.onSubmit,
      b = void 0 === r ? function() {} : r,
      f = o.onUpdate,
      v = void 0 === f ? function() {} : f,
      L = o.baseClass,
      m = void 0 === L ? 'autocomplete' : L,
      g = o.autocorrect,
      y = void 0 !== g && g,
      w = o.autoSelect,
      R = o.getResultValue,
      S =
        void 0 === R
          ? function(t) {
              return t
            }
          : R,
      x = o.renderResult,
      A = o.debounceTime,
      E = void 0 === A ? 0 : A,
      k = o.resultListLabel,
      I = o.submitOnEnter,
      C = void 0 !== I && I
    t(this, e),
      i(this, 'expanded', !1),
      i(this, 'loading', !1),
      i(this, 'position', {}),
      i(this, 'resetPosition', !0),
      i(this, 'initialize', function() {
        (s.root.style.position = 'relative'),
          s.input.setAttribute('role', 'combobox'),
          s.input.setAttribute('autocomplete', 'off'),
          s.input.setAttribute('autocapitalize', 'off'),
          s.autocorrect && s.input.setAttribute('autocorrect', 'on'),
          s.input.setAttribute('spellcheck', 'false'),
          s.input.setAttribute('aria-autocomplete', 'list'),
          s.input.setAttribute('aria-haspopup', 'listbox'),
          s.input.setAttribute('aria-expanded', 'false'),
          s.resultList.setAttribute('role', 'listbox')
        var t = h(s.resultListLabel)
        t && s.resultList.setAttribute(t.attribute, t.content),
          (s.resultList.style.position = 'absolute'),
          (s.resultList.style.zIndex = '1'),
          (s.resultList.style.width = '100%'),
          (s.resultList.style.boxSizing = 'border-box'),
          s.resultList.id ||
            (s.resultList.id = a(''.concat(s.baseClass, '-result-list-'))),
          s.input.setAttribute('aria-owns', s.resultList.id),
          document.body.addEventListener('click', s.handleDocumentClick),
          s.input.addEventListener('input', s.core.handleInput),
          s.input.addEventListener('keydown', s.core.handleKeyDown),
          s.input.addEventListener('focus', s.core.handleFocus),
          s.input.addEventListener('blur', s.core.handleBlur),
          s.resultList.addEventListener(
            'mousedown',
            s.core.handleResultMouseDown
          ),
          s.resultList.addEventListener('click', s.core.handleResultClick),
          s.updateStyle()
      }),
      i(this, 'destroy', function() {
        document.body.removeEventListener('click', s.handleDocumentClick),
          s.input.removeEventListener('input', s.core.handleInput),
          s.input.removeEventListener('keydown', s.core.handleKeyDown),
          s.input.removeEventListener('focus', s.core.handleFocus),
          s.input.removeEventListener('blur', s.core.handleBlur),
          s.resultList.removeEventListener(
            'mousedown',
            s.core.handleResultMouseDown
          ),
          s.resultList.removeEventListener('click', s.core.handleResultClick),
          (s.root = null),
          (s.input = null),
          (s.resultList = null),
          (s.getResultValue = null),
          (s.onUpdate = null),
          (s.renderResult = null),
          s.core.destroy(),
          (s.core = null)
      }),
      i(this, 'setAttribute', function(t, e) {
        s.input.setAttribute(t, e)
      }),
      i(this, 'setValue', function(t) {
        s.input.value = t ? s.getResultValue(t) : ''
      }),
      i(this, 'renderResult', function(t, e) {
        return '<li '.concat(e, '>').concat(s.getResultValue(t), '</li>')
      }),
      i(this, 'handleUpdate', function(t, e) {
        (s.resultList.innerHTML = ''),
          t.forEach(function(t, n) {
            var i = new p(n, e, s.baseClass),
              o = s.renderResult(t, i)
            'string' == typeof o
              ? s.resultList.insertAdjacentHTML('beforeend', o)
              : s.resultList.insertAdjacentElement('beforeend', o)
          }),
          s.input.setAttribute(
            'aria-activedescendant',
            e > -1 ? ''.concat(s.baseClass, '-result-').concat(e) : ''
          ),
          s.resetPosition &&
            ((s.resetPosition = !1),
            (s.position = c(s.input, s.resultList)),
            s.updateStyle()),
          s.core.checkSelectedResultVisible(s.resultList),
          s.onUpdate(t, e)
      }),
      i(this, 'handleShow', function() {
        (s.expanded = !0), s.updateStyle()
      }),
      i(this, 'handleHide', function() {
        (s.expanded = !1), (s.resetPosition = !0), s.updateStyle()
      }),
      i(this, 'handleLoading', function() {
        (s.loading = !0), s.updateStyle()
      }),
      i(this, 'handleLoaded', function() {
        (s.loading = !1), s.updateStyle()
      }),
      i(this, 'handleDocumentClick', function(t) {
        s.root.contains(t.target) || s.core.hideResults()
      }),
      i(this, 'updateStyle', function() {
        (s.root.dataset.expanded = s.expanded),
          (s.root.dataset.loading = s.loading),
          (s.root.dataset.position = s.position),
          (s.resultList.style.visibility = s.expanded ? 'visible' : 'hidden'),
          (s.resultList.style.pointerEvents = s.expanded ? 'auto' : 'none'),
          'below' === s.position
            ? ((s.resultList.style.bottom = null),
              (s.resultList.style.top = '100%'))
            : ((s.resultList.style.top = null),
              (s.resultList.style.bottom = '100%'))
      }),
      (this.root = 'string' == typeof n ? document.querySelector(n) : n),
      (this.input = this.root.querySelector('input')),
      (this.resultList = this.root.querySelector('ul')),
      (this.baseClass = m),
      (this.autocorrect = y),
      (this.getResultValue = S),
      (this.onUpdate = v),
      'function' == typeof x && (this.renderResult = x),
      (this.resultListLabel = k),
      (this.submitOnEnter = C)
    var U = new l({
      search: u,
      autoSelect: w,
      setValue: this.setValue,
      setAttribute: this.setAttribute,
      onUpdate: this.handleUpdate,
      autocorrect: this.autocorrect,
      onSubmit: b,
      onShow: this.handleShow,
      onHide: this.handleHide,
      onLoading: this.handleLoading,
      onLoaded: this.handleLoaded,
      submitOnEnter: this.submitOnEnter,
    })
    E > 0 && (U.handleInput = d(U.handleInput, E)),
      (this.core = U),
      this.initialize()
  })
})()
